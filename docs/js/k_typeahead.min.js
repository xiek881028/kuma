/*!
 * k_typeahead
 * xiekai <xk285985285.qq.com>
 * create: 2017/05/10
 * since: 0.0.1
 */window.k_typeahead=function(b,C){var d=this,c=C||{},n=c.height||"auto",D=c.width||b.offsetWidth,E=c.timer||500,v=c.maxList||10,w=c.buildList,p=c.searchEmpty||!1,x=c.className||"",F=c.query||function(){},G=c.heightLight||function(){},y=c.activeFn||function(){},H=c.buildBase||function(a){return a},z=c.customHeightLight||"",q,h,g=document.createElement("div"),r=!1,t=!1,f=-1,u=-1,m={},l="",k="",A="";this.staticFn={buildBase:function(){g.className="k_typeahead"+(x?" "+x:"");g.style.width=D+"px";g.style.height="string"==typeof n?n:n+"px";g.style.position="absolute";g.style.display="none";d.Fn.position();b.parentNode.appendChild(g);g.addEventListener("mousedown",d.staticFn.boxMousedown)},showBuild:function(a){if("[object Array]"===Object.prototype.toString.call(a)){var b='\x3cul class\x3d"k_typeaheadList"\x3e',B=[];ListData=a;void 0==m[k]&&(m[k]=a);f=-1;for(var e=0,c=arguments.length;e<c;e++)B.push(arguments[e]);e=0;for(c=a.length<v?a.length:v;e<c;e++)var h=[e],h=h.concat(B),h=void 0==w?a[e]:w.apply(this,h),b=b+("\x3cli title\x3d"+a[e]+"\x3e"+d.staticFn.heightLight(k,h)+"\x3c/li\x3e");g.innerHTML=H(b+"\x3c/ul\x3e");d.Fn.show(!0)}else throw Error("query\u7684callback\u63a5\u6536\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u7ec4");},heightLight:function(a,b){if(""==z){var d=new RegExp(a,"g"),e=G(a);return b=b.toString().replace(d,void 0==e?"\x3cstrong\x3e"+a+"\x3c/strong\x3e":e)}return z(a,b)},goSearch:function(){clearTimeout(q);if(p||""!=b.value&&!t)k=b.value,void 0!=m[k]?d.staticFn.showBuild(m[k]):q=setTimeout(function(){F(b.value,d.staticFn.showBuild)},E)},setActiveLi:function(a){for(var c=0,f=g.childNodes.length;c<f;c++){var e=g.childNodes[c];"ul"==e.nodeName.toLowerCase()&&"k_typeaheadList"==e.className&&(h=e.childNodes)}l=k;c=0;for(f=h.length;c<f;c++)h[c].className="";-1!=a?(h[a].className="active",a=d.staticFn.getText(h[a])):a=k;b.value=a},getText:function(a){var b="";a=a.childNodes||a;for(var c=0,e=a.length;c<e;c++)b+=1!=a[c].nodeType?a[c].nodeValue.replace(/[\s]/g,""):d.staticFn.getText(a[c].childNodes);return b},boxMousedown:function(a){a=a||event;"li"==a.target.nodeName.toLowerCase()&&"k_typeahead"==a.target.parentNode.parentNode.className&&(b.value=d.staticFn.getText(a.target),y(a.target),t=r=!0)},elFocus:function(a){a?((p||b.value)&&d.staticFn.goSearch(),r=t=!1):(clearTimeout(q),d.Fn.show(!1),r&&b.focus(),l&&(b.value=l,l=""))},elKeydown:function(a){a=a||event;38==+a.keyCode?(-1<f?f--:f=ListData.length-1,u=f,d.staticFn.setActiveLi(f)):40==+a.keyCode?(f<ListData.length-1?f++:f=-1,u=f,d.staticFn.setActiveLi(f)):13==+a.keyCode&&(d.Fn.show(!1),y(h[u]),l="")},elKeyup:function(a){a=a||event;38!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode&&(""!=b.value||p?A!=b.value&&d.staticFn.goSearch():d.Fn.show(!1));A=b.value}};this.Fn={init:function(){b.removeEventListener("focus",d.staticFn.elFocus);b.addEventListener("focus",d.staticFn.elFocus.bind(this,!0));b.removeEventListener("blur",d.staticFn.elFocus);b.addEventListener("blur",d.staticFn.elFocus.bind(this,!1));b.removeEventListener("keyup",d.staticFn.elKeyup);b.addEventListener("keyup",d.staticFn.elKeyup);b.removeEventListener("keydown",d.staticFn.elKeydown);b.addEventListener("keydown",d.staticFn.elKeydown);window.addEventListener("resize",d.Fn.position);d.staticFn.buildBase()},position:function(){g.style.left=b.offsetLeft+"px";g.style.top=b.offsetTop+b.offsetHeight+"px"},show:function(a){g.style.display=a?"inherit":"none";f=-1}};this.Fn.init();return this.Fn};