/*!
 * k_typeahead
 * xiekai <xk285985285.qq.com>
 * create: 2017/05/10
 * update: 2017/06/12
 * since: 0.1.4
 */window.k_typeahead=function(c,E){var b=this,d=E||{},u=d.height||"auto",F=d.width||c.offsetWidth,G=d.timer||500,y=d.maxList||10,z=d.buildList,v=d.searchEmpty||!1,A=d.className||"",H=d.query||function(){},I=d.heightLight||function(){},B=d.activeFn||function(){},J=d.buildBase||function(a){return a},C=d.customHeightLight||"",p=d.inputShowVal||"",q,g,e=document.createElement("div"),w=!1,x=!1,h=-1,r=-1,t={},m="",k="",n=[],D="";this.staticFn={buildBase:function(){e.className="k_typeahead"+(A?" "+A:"");e.style.width=F+"px";e.style.height="string"==typeof u?u:u+"px";e.style.position="absolute";e.style.display="none";b.Fn.position();c.parentNode.appendChild(e);c.setAttribute&&c.setAttribute("autocomplete","off");e.addEventListener?(e.removeEventListener("mousedown",b.staticFn.boxMousedown),e.addEventListener("mousedown",b.staticFn.boxMousedown)):e.attachEvent&&(e.detachEvent("onmousedown",b.staticFn.boxMousedown),e.attachEvent("onmousedown",b.staticFn.boxMousedown))},showBuild:function(a){if("[object Array]"===Object.prototype.toString.call(a)){var c='\x3cul class\x3d"k_typeaheadList"\x3e',l=[];n=a;void 0==t[k]&&(t[k]=a);h=-1;for(var f=0,d=arguments.length;f<d;f++)l.push(arguments[f]);f=0;for(d=a.length<y?a.length:y;f<d;f++)var g=[f],g=g.concat(l),g=void 0==z?a[f]:z.apply(this,g),c=c+("\x3cli\x3e"+b.staticFn.heightLight(k,g,a[f])+"\x3c/li\x3e");e.innerHTML=J(c+"\x3c/ul\x3e");b.Fn.show(!0)}else throw Error("query\u7684callback\u63a5\u6536\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u7ec4");},heightLight:function(a,b,c){if(""==C){c=new RegExp(a,"g");var f=I(a);return b=b.toString().replace(c,void 0==f?"\x3cstrong\x3e"+a+"\x3c/strong\x3e":f)}return C(a,b,c)},goSearch:function(){clearTimeout(q);if(v||""!=c.value&&!x)k=c.value,void 0!=t[k]?b.staticFn.showBuild(t[k]):q=setTimeout(function(){H(c.value,b.staticFn.showBuild)},G)},setActiveLi:function(a){for(var d=0,l=e.childNodes.length;d<l;d++){var f=e.childNodes[d];"ul"==f.nodeName.toLowerCase()&&"k_typeaheadList"==f.className&&(g=f.childNodes)}m=k;d=0;for(l=g.length;d<l;d++)g[d].className="";-1!=a?(g[a].className="active",a=""==p?b.staticFn.getText(g[a]):p(g[a],b.staticFn.getText)):a=k;c.value=a},getText:function(a){var c="";a=a.childNodes||a;for(var d=0,f=a.length;d<f;d++)c+=1!=a[d].nodeType?a[d].nodeValue.replace(/[\s]/g,""):b.staticFn.getText(a[d].childNodes);return c},isActiveLi:function(a){return"li"==a.nodeName.toLowerCase()?a.parentNode.parentNode.className===e.className?a:b.staticFn.isActiveLi(a.parentNode):"li"!=a.nodeName.toLowerCase()&&"html"!=a.nodeName.toLowerCase()?b.staticFn.isActiveLi(a.parentNode):!1},index:function(a){var b=0,c;c=function(a){null!=a.previousSibling&&(b++,c(a.previousSibling))};c(a);return b},boxMousedown:function(a){a=a||event;a=b.staticFn.isActiveLi(a.target?a.target:a.srcElement);!1!==a&&(c.value=""==p?b.staticFn.getText(a):p(a,b.staticFn.getText),B(n,b.staticFn.index(a),a),x=w=!0)},elFocus:function(){(v||c.value)&&b.staticFn.goSearch();w=x=!1},elBlur:function(){clearTimeout(q);b.Fn.show(!1);w&&c.focus();m&&(c.value=m,m="")},elKeydown:function(a){a=a||event;38==+a.keyCode?(-1<h?h--:h=n.length-1,r=h,b.staticFn.setActiveLi(h)):40==+a.keyCode?(h<n.length-1?h++:h=-1,r=h,b.staticFn.setActiveLi(h)):13==+a.keyCode&&(b.Fn.show(!1),B(n,r,g[r]),m="")},elKeyup:function(a){a=a||event;38!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode&&(""!=c.value||v?D!=c.value&&b.staticFn.goSearch():(clearTimeout(q),b.Fn.show(!1)));D=c.value}};this.Fn={init:function(){window.addEventListener?(c.removeEventListener("focus",b.staticFn.elFocus),c.addEventListener("focus",b.staticFn.elFocus),c.removeEventListener("blur",b.staticFn.elBlur),c.addEventListener("blur",b.staticFn.elBlur),c.removeEventListener("keyup",b.staticFn.elKeyup),c.addEventListener("keyup",b.staticFn.elKeyup),c.removeEventListener("keydown",b.staticFn.elKeydown),c.addEventListener("keydown",b.staticFn.elKeydown),window.addEventListener("resize",b.Fn.position)):window.attachEvent&&(c.detachEvent("onfocus",b.staticFn.elFocus),c.attachEvent("onfocus",b.staticFn.elFocus),c.detachEvent("onblur",b.staticFn.elBlur),c.attachEvent("onblur",b.staticFn.elBlur),c.detachEvent("onkeyup",b.staticFn.elKeyup),c.attachEvent("onkeyup",b.staticFn.elKeyup),c.detachEvent("onkeydown",b.staticFn.elKeydown),c.attachEvent("onkeydown",b.staticFn.elKeydown),window.attachEvent("onresize",b.Fn.position));b.staticFn.buildBase()},position:function(){e.style.left=c.offsetLeft+"px";e.style.top=c.offsetTop+c.offsetHeight+"px"},show:function(a){e.style.display=a?"inherit":"none";h=-1}};this.Fn.init();return this.Fn};