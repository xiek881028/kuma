/*!
 * k_typeahead
 * xiekai <xk285985285.qq.com>
 * create: 2017/05/10
 * since: 0.0.1
 */window.k_typeahead=function(c,C){var b=this,d=C||{},n=d.height||"auto",D=d.width||c.offsetWidth,E=d.timer||500,v=d.maxList||10,w=d.buildList,p=d.searchEmpty||!1,x=d.className||"",F=d.query||function(){},G=d.heightLight||function(){},y=d.activeFn||function(){},H=d.buildBase||function(a){return a},z=d.customHeightLight||"",q,h,e=document.createElement("div"),r=!1,t=!1,f=-1,u=-1,m={},l="",k="",A="";this.staticFn={buildBase:function(){e.className="k_typeahead"+(x?" "+x:"");e.style.width=D+"px";e.style.height="string"==typeof n?n:n+"px";e.style.position="absolute";e.style.display="none";b.Fn.position();c.parentNode.appendChild(e);e.addEventListener?(e.removeEventListener("mousedown",b.staticFn.boxMousedown),e.addEventListener("mousedown",b.staticFn.boxMousedown)):e.attachEvent&&(e.detachEvent("onmousedown",b.staticFn.boxMousedown),e.attachEvent("onmousedown",b.staticFn.boxMousedown))},showBuild:function(a){if("[object Array]"===Object.prototype.toString.call(a)){var c='\x3cul class\x3d"k_typeaheadList"\x3e',B=[];ListData=a;void 0==m[k]&&(m[k]=a);f=-1;for(var g=0,d=arguments.length;g<d;g++)B.push(arguments[g]);g=0;for(d=a.length<v?a.length:v;g<d;g++)var h=[g],h=h.concat(B),h=void 0==w?a[g]:w.apply(this,h),c=c+("\x3cli title\x3d"+a[g]+"\x3e"+b.staticFn.heightLight(k,h)+"\x3c/li\x3e");e.innerHTML=H(c+"\x3c/ul\x3e");b.Fn.show(!0)}else throw Error("query\u7684callback\u63a5\u6536\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u7ec4");},heightLight:function(a,b){if(""==z){var c=new RegExp(a,"g"),e=G(a);return b=b.toString().replace(c,void 0==e?"\x3cstrong\x3e"+a+"\x3c/strong\x3e":e)}return z(a,b)},goSearch:function(){clearTimeout(q);if(p||""!=c.value&&!t)k=c.value,void 0!=m[k]?b.staticFn.showBuild(m[k]):q=setTimeout(function(){F(c.value,b.staticFn.showBuild)},E)},setActiveLi:function(a){for(var d=0,f=e.childNodes.length;d<f;d++){var g=e.childNodes[d];"ul"==g.nodeName.toLowerCase()&&"k_typeaheadList"==g.className&&(h=g.childNodes)}l=k;d=0;for(f=h.length;d<f;d++)h[d].className="";-1!=a?(h[a].className="active",a=b.staticFn.getText(h[a])):a=k;c.value=a},getText:function(a){var c="";a=a.childNodes||a;for(var d=0,e=a.length;d<e;d++)c+=1!=a[d].nodeType?a[d].nodeValue.replace(/[\s]/g,""):b.staticFn.getText(a[d].childNodes);return c},boxMousedown:function(a){a=a||event;a=a.target?a.target:a.srcElement;"li"==a.nodeName.toLowerCase()&&"k_typeahead"==a.parentNode.parentNode.className&&(c.value=b.staticFn.getText(a),y(a),t=r=!0)},elFocus:function(){(p||c.value)&&b.staticFn.goSearch();r=t=!1},elBlur:function(){clearTimeout(q);b.Fn.show(!1);r&&c.focus();l&&(c.value=l,l="")},elKeydown:function(a){a=a||event;38==+a.keyCode?(-1<f?f--:f=ListData.length-1,u=f,b.staticFn.setActiveLi(f)):40==+a.keyCode?(f<ListData.length-1?f++:f=-1,u=f,b.staticFn.setActiveLi(f)):13==+a.keyCode&&(b.Fn.show(!1),y(h[u]),l="")},elKeyup:function(a){a=a||event;38!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode&&(""!=c.value||p?A!=c.value&&b.staticFn.goSearch():b.Fn.show(!1));A=c.value}};this.Fn={init:function(){window.addEventListener?(c.removeEventListener("focus",b.staticFn.elFocus),c.addEventListener("focus",b.staticFn.elFocus),c.removeEventListener("blur",b.staticFn.elBlur),c.addEventListener("blur",b.staticFn.elBlur),c.removeEventListener("keyup",b.staticFn.elKeyup),c.addEventListener("keyup",b.staticFn.elKeyup),c.removeEventListener("keydown",b.staticFn.elKeydown),c.addEventListener("keydown",b.staticFn.elKeydown),window.addEventListener("resize",b.Fn.position)):window.attachEvent&&(c.detachEvent("onfocus",b.staticFn.elFocus),c.attachEvent("onfocus",b.staticFn.elFocus),c.detachEvent("onblur",b.staticFn.elBlur),c.attachEvent("onblur",b.staticFn.elBlur),c.detachEvent("onkeyup",b.staticFn.elKeyup),c.attachEvent("onkeyup",b.staticFn.elKeyup),c.detachEvent("onkeydown",b.staticFn.elKeydown),c.attachEvent("onkeydown",b.staticFn.elKeydown),window.attachEvent("onresize",b.Fn.position));b.staticFn.buildBase()},position:function(){e.style.left=c.offsetLeft+"px";e.style.top=c.offsetTop+c.offsetHeight+"px"},show:function(a){e.style.display=a?"inherit":"none";f=-1}};this.Fn.init();return this.Fn};