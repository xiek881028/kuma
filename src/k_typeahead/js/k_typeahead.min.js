/*!
 * k_typeahead
 * xiekai <xk285985285.qq.com>
 * create: 2017/05/10
 * update: 2017/05/15
 * since: 0.1.1
 */window.k_typeahead=function(c,D){var b=this,d=D||{},p=d.height||"auto",E=d.width||c.offsetWidth,F=d.timer||500,w=d.maxList||10,x=d.buildList,q=d.searchEmpty||!1,y=d.className||"",G=d.query||function(){},H=d.heightLight||function(){},z=d.activeFn||function(){},I=d.buildBase||function(a){return a},A=d.customHeightLight||"",m=d.inputShowVal||"",r,g,e=document.createElement("div"),t=!1,u=!1,f=-1,v=-1,n={},l="",k="",B="";this.staticFn={buildBase:function(){e.className="k_typeahead"+(y?" "+y:"");e.style.width=E+"px";e.style.height="string"==typeof p?p:p+"px";e.style.position="absolute";e.style.display="none";b.Fn.position();c.parentNode.appendChild(e);e.addEventListener?(e.removeEventListener("mousedown",b.staticFn.boxMousedown),e.addEventListener("mousedown",b.staticFn.boxMousedown)):e.attachEvent&&(e.detachEvent("onmousedown",b.staticFn.boxMousedown),e.attachEvent("onmousedown",b.staticFn.boxMousedown))},showBuild:function(a){if("[object Array]"===Object.prototype.toString.call(a)){var c='\x3cul class\x3d"k_typeaheadList"\x3e',C=[];ListData=a;void 0==n[k]&&(n[k]=a);f=-1;for(var h=0,d=arguments.length;h<d;h++)C.push(arguments[h]);h=0;for(d=a.length<w?a.length:w;h<d;h++)var g=[h],g=g.concat(C),g=void 0==x?a[h]:x.apply(this,g),c=c+("\x3cli\x3e"+b.staticFn.heightLight(k,g,a[h])+"\x3c/li\x3e");e.innerHTML=I(c+"\x3c/ul\x3e");b.Fn.show(!0)}else throw Error("query\u7684callback\u63a5\u6536\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u5fc5\u987b\u662f\u4e00\u4e2a\u6570\u7ec4");},heightLight:function(a,b,c){if(""==A){c=new RegExp(a,"g");var e=H(a);return b=b.toString().replace(c,void 0==e?"\x3cstrong\x3e"+a+"\x3c/strong\x3e":e)}return A(a,b,c)},goSearch:function(){clearTimeout(r);if(q||""!=c.value&&!u)k=c.value,void 0!=n[k]?b.staticFn.showBuild(n[k]):r=setTimeout(function(){G(c.value,b.staticFn.showBuild)},F)},setActiveLi:function(a){for(var d=0,f=e.childNodes.length;d<f;d++){var h=e.childNodes[d];"ul"==h.nodeName.toLowerCase()&&"k_typeaheadList"==h.className&&(g=h.childNodes)}l=k;d=0;for(f=g.length;d<f;d++)g[d].className="";-1!=a?(g[a].className="active",a=""==m?b.staticFn.getText(g[a]):m(g[a],b.staticFn.getText)):a=k;c.value=a},getText:function(a){var c="";a=a.childNodes||a;for(var d=0,e=a.length;d<e;d++)c+=1!=a[d].nodeType?a[d].nodeValue.replace(/[\s]/g,""):b.staticFn.getText(a[d].childNodes);return c},isActiveLi:function(a){return"li"==a.nodeName.toLowerCase()?a.parentNode.parentNode.className===e.className?a:b.staticFn.isActiveLi(a.parentNode):"li"!=a.nodeName.toLowerCase()&&"html"!=a.nodeName.toLowerCase()?b.staticFn.isActiveLi(a.parentNode):!1},boxMousedown:function(a){a=a||event;a=b.staticFn.isActiveLi(a.target?a.target:a.srcElement);!1!==a&&(c.value=""==m?b.staticFn.getText(a):m(a,b.staticFn.getText),z(a),u=t=!0)},elFocus:function(){(q||c.value)&&b.staticFn.goSearch();t=u=!1},elBlur:function(){clearTimeout(r);b.Fn.show(!1);t&&c.focus();l&&(c.value=l,l="")},elKeydown:function(a){a=a||event;38==+a.keyCode?(-1<f?f--:f=ListData.length-1,v=f,b.staticFn.setActiveLi(f)):40==+a.keyCode?(f<ListData.length-1?f++:f=-1,v=f,b.staticFn.setActiveLi(f)):13==+a.keyCode&&(b.Fn.show(!1),z(g[v]),l="")},elKeyup:function(a){a=a||event;38!=a.keyCode&&40!=a.keyCode&&13!=a.keyCode&&(""!=c.value||q?B!=c.value&&b.staticFn.goSearch():b.Fn.show(!1));B=c.value}};this.Fn={init:function(){window.addEventListener?(c.removeEventListener("focus",b.staticFn.elFocus),c.addEventListener("focus",b.staticFn.elFocus),c.removeEventListener("blur",b.staticFn.elBlur),c.addEventListener("blur",b.staticFn.elBlur),c.removeEventListener("keyup",b.staticFn.elKeyup),c.addEventListener("keyup",b.staticFn.elKeyup),c.removeEventListener("keydown",b.staticFn.elKeydown),c.addEventListener("keydown",b.staticFn.elKeydown),window.addEventListener("resize",b.Fn.position)):window.attachEvent&&(c.detachEvent("onfocus",b.staticFn.elFocus),c.attachEvent("onfocus",b.staticFn.elFocus),c.detachEvent("onblur",b.staticFn.elBlur),c.attachEvent("onblur",b.staticFn.elBlur),c.detachEvent("onkeyup",b.staticFn.elKeyup),c.attachEvent("onkeyup",b.staticFn.elKeyup),c.detachEvent("onkeydown",b.staticFn.elKeydown),c.attachEvent("onkeydown",b.staticFn.elKeydown),window.attachEvent("onresize",b.Fn.position));b.staticFn.buildBase()},position:function(){e.style.left=c.offsetLeft+"px";e.style.top=c.offsetTop+c.offsetHeight+"px"},show:function(a){e.style.display=a?"inherit":"none";f=-1}};this.Fn.init();return this.Fn};